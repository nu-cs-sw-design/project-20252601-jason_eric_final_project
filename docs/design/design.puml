@startuml
skinparam packageStyle rectangle
skinparam shadowing false

package model {
    interface UserRepository {
        +addUser(username, password)
        +validateLogin(username, password)
        +find(username)
    }
    class InMemoryUserRepository {
        -users: Map<String, User>
    }
    class User {
        -username: String
        -password: String
    }

    interface WorkoutRepository {
        +add(username, Workout)
        +update(username, Workout)
        +find(username, date)
        +delete(username, date)
        +exists(username, date)
        +search(username, WorkoutSearchCriteria)
        +list(username)
    }
    class InMemoryWorkoutRepository {
        -store: Map<String, Map<LocalDate, Workout>>
    }
    class Workout {
        -date: LocalDate
        -name: String
        -exercises: List<Exercise>
    }
    class Exercise {
        -name: String
        -sets: int
        -reps: int
        -weight: double
    }
    class WorkoutSearchCriteria {
        -date: Optional<LocalDate>
        -workoutName: Optional<String>
        -exerciseName: Optional<String>
    }

    interface BodyInfoRepository {
        +save(username, BodyInfo)
        +fetch(username)
    }
    class InMemoryBodyInfoRepository {
        -store: Map<String, BodyInfo>
    }
    class BodyInfo {
        -age: int
        -heightInches: int
        -weightPounds: int
        -sex: String
    }

    interface CalorieLogRepository {
        +log(username, CalorieEntry)
        +list(username)
        +totalForRange(username, from, to)
    }
    class InMemoryCalorieLogRepository {
        -store: Map<String, List<CalorieEntry>>
    }
    class CalorieEntry {
        -date: LocalDate
        -calories: int
        -description: String
    }
    interface WorkoutObserver {
        +onWorkoutChanged(username, workouts)
    }

    interface BodyInfoObserver {
        +onBodyInfoChanged(username, bodyInfo)
    }

    interface CalorieLogObserver {
        +onCalorieLogChanged(username, entries)
    }
}

package controller {
    class AuthController {
        -userRepository: UserRepository
    }
    class WorkoutController {
        -workoutRepository: WorkoutRepository
        -observers: List<WorkoutObserver>
    }
    class BodyInfoController {
        -repository: BodyInfoRepository
        -observers: List<BodyInfoObserver>
    }
    class CalorieController {
        -repository: CalorieLogRepository
        -observers: List<CalorieLogObserver>
    }
}

package view {
    class AppFrame {
        -authController: AuthController
        -workoutController: WorkoutController
        -bodyInfoController: BodyInfoController
        -calorieController: CalorieController
        -currentUser: String
    }
    class WelcomeScreen
    class LoginScreen
    class CreateAccountScreen
    class MainMenuScreen
    class LogWorkoutScreen
    class EditWorkoutScreen
    class DeleteWorkoutScreen
    class SearchWorkoutScreen
    class BodyInfoScreen
    class CalorieLogScreen
    class CalorieGraphScreen
    class WorkoutGraphScreen

    interface NavigationContext {
        +showScreen(name)
        +ensureLoggedIn()
        +getCurrentUser()
        +setCurrentUser(user)
    }
}

package app {
    class Main {
        +main(args: String[])
    }
}

InMemoryUserRepository ..|> UserRepository
InMemoryWorkoutRepository ..|> WorkoutRepository
InMemoryBodyInfoRepository ..|> BodyInfoRepository
InMemoryCalorieLogRepository ..|> CalorieLogRepository

InMemoryUserRepository --> User
BodyInfoRepository --> BodyInfo
CalorieLogRepository --> CalorieEntry
WorkoutRepository --> Workout

Workout "1" o-- "*" Exercise
WorkoutSearchCriteria --> Workout

AuthController --> UserRepository
WorkoutController --> WorkoutRepository
WorkoutController o--> WorkoutObserver
BodyInfoController --> BodyInfoRepository
BodyInfoController o--> BodyInfoObserver
CalorieController --> CalorieLogRepository
CalorieController o--> CalorieLogObserver

AppFrame ..|> NavigationContext
AppFrame --> AuthController
AppFrame --> WorkoutController
AppFrame --> BodyInfoController
AppFrame --> CalorieController

LoginScreen --> AuthController
CreateAccountScreen --> AuthController
LogWorkoutScreen --> WorkoutController
EditWorkoutScreen --> WorkoutController
DeleteWorkoutScreen --> WorkoutController
SearchWorkoutScreen --> WorkoutController
WorkoutGraphScreen --> WorkoutController
BodyInfoScreen --> BodyInfoController
CalorieLogScreen --> CalorieController
CalorieGraphScreen --> CalorieController

WelcomeScreen --> NavigationContext
LoginScreen --> NavigationContext
CreateAccountScreen --> NavigationContext
MainMenuScreen --> NavigationContext
LogWorkoutScreen --> NavigationContext
EditWorkoutScreen --> NavigationContext
DeleteWorkoutScreen --> NavigationContext
SearchWorkoutScreen --> NavigationContext
BodyInfoScreen --> NavigationContext
CalorieLogScreen --> NavigationContext
CalorieGraphScreen --> NavigationContext
WorkoutGraphScreen --> NavigationContext

WorkoutGraphScreen ..|> WorkoutObserver
BodyInfoScreen ..|> BodyInfoObserver
CalorieLogScreen ..|> CalorieLogObserver

Main --> AppFrame

@enduml
